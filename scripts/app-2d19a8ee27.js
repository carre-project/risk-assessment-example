angular.module("CarreExample",["ngCookies","ngSanitize","ngAnimate","cfp.loadingBar","ngOnload"]).config(["$locationProvider",function(e){e.html5Mode(!0)}]).controller("ExampleController",["$scope","$location","API","$sce","$timeout","cfpLoadingBar","CONFIG",function(e,a,r,n,t,s,i){function o(){e.user.username&&r.lastMeasurements(e.user).then(function(e){var a=e.data;m.predicates=[],m.values={},m.observable_names={},m.ob_dates={},a.map(function(e){m.predicates.push(e.p.value.replace("http://carre.kmi.open.ac.uk/ontology/sensors.owl#",":")),m.values[l(e.ob.value)]=e.value.value,m.observable_names[l(e.ob.value)]=e.ob_name.value,m.ob_dates[l(e.ob.value)]=e.date.value}),c()},function(e){})}function c(){r.risk_evidences(e.user,m.predicates).then(function(a){var r=a.data;m.summary=[],m.risk_evidences={},m.risk_factors={},m.total_risk_evidences=r.length,r.forEach(function(e){var a=RiskEvidenceConditionParser.evaluate(e.condition.value,m.values);if(a){var r=l(e.risk_factor.value),n=l(e.risk_evidence.value),t=l(e.has_risk_factor_source.value),s=l(e.has_risk_factor_target.value),i=l(e.rl_source_name.value)+" "+l(e.has_risk_factor_association_type.value)+" "+l(e.rl_target_name.value);m.risk_elements,m.risk_factors[r]=m.risk_factors[r]||{label:i,source:t,target:s,evidences:[]},m.risk_factors[r].evidences.push(n),m.risk_evidences[n]={confidence_interval_min:e.confidence_interval_min.value,confidence_interval_max:e.confidence_interval_max.value,risk_evidence_ratio_value:e.risk_evidence_ratio_value.value}}}),_(m),e.loading=!1})}function _(a){e.risk_factors=[];for(var r in a.risk_factors)e.risk_factors.push({label:a.risk_factors[r].label,link:"https://entry.carre-project.eu/risk_factors/"+r,evidences:a.risk_factors[r].evidences.map(function(e){return{link:"https://entry.carre-project.eu/risk_evidences/"+e,label:e,ratio:a.risk_evidences[e].risk_evidence_ratio_value}})});e.measurements=[];for(var n in a.observable_names)e.measurements.push({label:a.observable_names[n],link:"https://entry.carre-project.eu/observables/"+n,value:a.values[n],date:new Date(a.ob_dates[n]).toLocaleString()});u()}function u(){e.iframesLoaded=0;var a="//entry.carre-project.eu/",r="explore?embed=true&hidemenu=true&showonlygraph=true&elementstype=risk_evidences&lang="+i.language,t=a+r+"&elements="+Object.keys(m.risk_evidences).join(",");e.entrysystemUrlSankey=n.trustAsResourceUrl(t+"&graphtype=sankey")}function l(e){var a="";return a=e.indexOf("#")>=0?e.substring(e.lastIndexOf("#")+1).replace("risk_factor_association_type",""):e.substring(e.lastIndexOf("/")+1),a.indexOf("RF_")+a.indexOf("OB_")+a.indexOf("RV_")+a.indexOf("RL_")>-4?a:a.replace(/[_-]+/g," ")}var k=r.accounts,d="66efc31e652208e257c3781b2a40376084c0a2ac",v=null;a.search().token&&(v=a.search().token),a.url("/").replace();var f=a.absUrl();e.loginUrl=k+"/login?next="+f,e.logoutUrl=k+"/logout?next="+f,e.visualizationType="list",r.user(v).then(function(a){e.user={oauth_token:a.oauth_token,username:a.username},e.loadData()}),e.loadTestUser=function(){r.user(d).then(function(a){e.user={oauth_token:a.oauth_token,username:a.username},e.loadData()})},e.loadData=function(){e.measurements=[],e.loading=!0,s.start(),o()};var m={};e.lang=i.language,e.changeLanguage=function(){i.language=e.lang,e.loadData()},e.iframeLoaded=function(){e.iframesLoaded++,1===e.iframesLoaded&&s.complete()}}]),angular.module("CarreExample").constant("CONFIG",{language:"el"}).service("API",["$http","$cookies","$q","CONFIG",function(e,a,r,n){function t(n){var t=a.get("CARRE_USER")||n||"";if(t.length>0)return e.get(c+"userProfile?token="+t).then(function(e){return{oauth_token:t,username:e.data.username,email:e.data.email}},function(e){return{}});var s=r.defer();return s.reject({}),s.promise}function s(a){var r=_+"SELECT ?date ?p ?value ?ob ?ob_name FROM <https://carre.kmi.open.ac.uk/users/"+a.username+"> FROM <http://carre.kmi.open.ac.uk/riskdata> WHERE {  \n    { \n    SELECT max(?d) as ?date ?p FROM <https://carre.kmi.open.ac.uk/users/"+a.username+"> WHERE { \n            ?m :has_date / :has_value ?d ; ?p ?o . \n            ?o :has_value ?v1 . \n                FILTER(!(?p = :has_date) && !(?p = :has_start_date)&& !(?p = :has_end_date) && !(?p = :has_sleep_status)) \n        } } \n    ?measurement :has_date / :has_value ?date ; ?p ?o . \n    ?o :has_value ?value . ?ob a risk:observable ; risk:has_external_predicate ?p; risk:has_observable_name ?ob_name.  \n    FILTER (lang(?ob_name)='"+n.language+"') \n    } \n";return e.post(c+"query?token="+a.oauth_token+"&sparql="+encodeURIComponent(r))}function i(a,r){var t=_+"SELECT DISTINCT ?risk_evidence ?condition ?confidence_interval_min ?confidence_interval_max ?risk_evidence_ratio_value ?risk_evidence_ratio_type ?risk_factor ?has_risk_factor_source ?has_risk_factor_target ?rl_source_name ?rl_target_name ?has_risk_factor_association_type FROM <http://carre.kmi.open.ac.uk/riskdata> WHERE {  \n   ?risk_evidence a risk:risk_evidence ;  \n   risk:has_risk_factor ?risk_factor;  \n  risk:has_risk_evidence_ratio_type ?risk_evidence_ratio_type;  \n    risk:has_risk_evidence_ratio_value ?risk_evidence_ratio_value;  \n    risk:has_confidence_interval_max ?confidence_interval_max;  \n    risk:has_confidence_interval_min ?confidence_interval_min;  \n    risk:has_risk_evidence_observable ?ob ;  \n    risk:has_observable_condition ?condition .  \n  #details for risk factor  \n  ?risk_factor risk:has_risk_factor_association_type ?has_risk_factor_association_type;  \n  risk:has_risk_factor_source ?has_risk_factor_source;  \n  risk:has_risk_factor_target ?has_risk_factor_target.  \n  ?has_risk_factor_source risk:has_risk_element_name ?rl_source_name.  \n  ?has_risk_factor_target risk:has_risk_element_name ?rl_target_name.   \n  FILTER(lang(?rl_source_name)='"+n.language+"')   \n  FILTER(lang(?rl_target_name)='"+n.language+"')   \n  {  \n   SELECT ?ob FROM <http://carre.kmi.open.ac.uk/riskdata> WHERE {  \n   ?ob a risk:observable ;  \n          risk:has_external_predicate ?p.    \n  VALUES ?p {  \n "+r.join(" ")+" }  \n  }  \n  }  \n  }";return e.post(c+"query?token="+a.oauth_token+"&sparql="+encodeURIComponent(t))}var o="https://devices.carre-project.eu/devices/accounts",c="https://devices.carre-project.eu/ws/",_="PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> \n            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \n            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> \n            PREFIX : <http://carre.kmi.open.ac.uk/ontology/sensors.owl#> \n            PREFIX risk: <http://carre.kmi.open.ac.uk/ontology/risk.owl#> \n            PREFIX carreManufacturer: <http://carre.kmi.open.ac.uk/manufacturers/> \n            PREFIX carreUsers: <https://carre.kmi.open.ac.uk/users/> \n ";return this.exports={accounts:o,user:t,lastMeasurements:s,risk_evidences:i},this.exports}]);
//# sourceMappingURL=../maps/scripts/app-2d19a8ee27.js.map
